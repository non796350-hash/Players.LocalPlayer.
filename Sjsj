local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local cam = workspace.CurrentCamera

--// PERMISSION
local allowed = false
for _,id in ipairs(ALLOWED_USER_IDS) do
    if player.UserId == id then allowed = true break end
end
if not allowed then return end

--// STATE
local speedOn, xrayOn, espOn, aimOn = false, false, false, false
local speedValue, xrayValue = 16, 0.6

--// GUI ROOT
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.Name = "MiniTestHub"
gui.ResetOnSpawn = false

--// HUB FRAME (‡πÄ‡∏•‡πá‡∏Å ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏™‡∏ö‡∏≤‡∏¢)
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,180,0,240)
frame.Position = UDim2.new(0,10,0.5,-120)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

--// UI HELPERS
local function label(text,y)
    local l = Instance.new("TextLabel", frame)
    l.Size = UDim2.new(1,-10,0,18)
    l.Position = UDim2.new(0,5,0,y)
    l.Text = text
    l.TextColor3 = Color3.new(1,1,1)
    l.BackgroundTransparency = 1
    l.TextSize = 12
    l.TextXAlignment = Left
    return l
end

local function button(text,y)
    local b = Instance.new("TextButton", frame)
    b.Size = UDim2.new(1,-10,0,28)
    b.Position = UDim2.new(0,5,0,y)
    b.Text = text
    b.TextSize = 12
    b.BackgroundColor3 = Color3.fromRGB(45,45,45)
    b.TextColor3 = Color3.new(1,1,1)
    b.BorderSizePixel = 0
    return b
end

local function slider(y,min,max,default,callback)
    local bg = Instance.new("Frame", frame)
    bg.Size = UDim2.new(1,-10,0,16)
    bg.Position = UDim2.new(0,5,0,y)
    bg.BackgroundColor3 = Color3.fromRGB(50,50,50)
    bg.BorderSizePixel = 0

    local fill = Instance.new("Frame", bg)
    fill.Size = UDim2.new((default-min)/(max-min),0,1,0)
    fill.BackgroundColor3 = Color3.fromRGB(0,170,255)
    fill.BorderSizePixel = 0

    local dragging = false
    bg.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1
        or i.UserInputType == Enum.UserInputType.Touch then dragging = true end
    end)
    bg.InputEnded:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1
        or i.UserInputType == Enum.UserInputType.Touch then dragging = false end
    end)
    UIS.InputChanged:Connect(function(i)
        if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement
        or i.UserInputType == Enum.UserInputType.Touch) then
            local x = math.clamp((i.Position.X - bg.AbsolutePosition.X)/bg.AbsoluteSize.X,0,1)
            fill.Size = UDim2.new(x,0,1,0)
            callback(min + (max-min)*x)
        end
    end)
end

--// UI CONTENT
label("‚ö° Speed",5)
local speedBtn = button("Speed : OFF",25)
label("Speed Value",60)
slider(80,16,60,16,function(v)
    speedValue = math.floor(v)
    if speedOn and player.Character then
        player.Character.Humanoid.WalkSpeed = speedValue
    end
end)

label("üëÅ X-Ray Transparency",105)
slider(125,0,0.9,0.6,function(v)
    xrayValue = v
    if xrayOn then
        for _,p in ipairs(workspace:GetDescendants()) do
            if p:IsA("BasePart") and not p.Parent:FindFirstChild("Humanoid") then
                p.LocalTransparencyModifier = xrayValue
            end
        end
    end
end)

local xrayBtn = button("X-Ray : OFF",150)
local espBtn  = button("ESP : OFF",182)
local aimBtn  = button("Aim Assist : OFF",214)

--// SPEED
speedBtn.MouseButton1Click:Connect(function()
    speedOn = not speedOn
    speedBtn.Text = speedOn and "Speed : ON" or "Speed : OFF"
    if player.Character then
        player.Character.Humanoid.WalkSpeed = speedOn and speedValue or 16
    end
end)
player.CharacterAdded:Connect(function(c)
    c:WaitForChild("Humanoid").WalkSpeed = speedOn and speedValue or 16
end)

--// X-RAY
xrayBtn.MouseButton1Click:Connect(function()
    xrayOn = not xrayOn
    xrayBtn.Text = xrayOn and "X-Ray : ON" or "X-Ray : OFF"
    for _,p in ipairs(workspace:GetDescendants()) do
        if p:IsA("BasePart") and not p.Parent:FindFirstChild("Humanoid") then
            p.LocalTransparencyModifier = xrayOn and xrayValue or 0
        end
    end
end)

--// ESP (Highlight)
local function applyESP()
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and not plr.Character:FindFirstChild("ESP") then
            local h = Instance.new("Highlight")
            h.Name = "ESP"
            h.FillColor = Color3.fromRGB(255,0,0)
            h.OutlineColor = Color3.new(1,1,1)
            h.Parent = plr.Character
        end
    end
end
local function clearESP()
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr.Character and plr.Character:FindFirstChild("ESP") then
            plr.Character.ESP:Destroy()
        end
    end
end
espBtn.MouseButton1Click:Connect(function()
    espOn = not espOn
    espBtn.Text = espOn and "ESP : ON" or "ESP : OFF"
    if espOn then applyESP() else clearESP() end
end)

--// AIM ASSIST (NPC/Dummy ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
RunService.RenderStepped:Connect(function()
    if aimOn then
        local t = workspace:FindFirstChild("TargetDummy")
        if t and t:FindFirstChild("Head") then
            cam.CFrame = CFrame.new(cam.CFrame.Position, t.Head.Position)
        end
    end
end)
aimBtn.MouseButton1Click:Connect(function()
    aimOn = not aimOn
    aimBtn.Text = aimOn and "Aim Assist : ON" or "Aim Assist : OFF"
end)

--// TOGGLE HUB (‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
local toggleBtn = Instance.new("TextButton", gui)
toggleBtn.Size = UDim2.new(0,42,0,42)
toggleBtn.Position = UDim2.new(0,10,0.5,-180)
toggleBtn.BackgroundColor3 = Color3.fromRGB(0,170,255)
toggleBtn.Text = "‚â°"
toggleBtn.TextSize = 20
toggleBtn.TextColor3 = Color3.new(1,1,1)
toggleBtn.BorderSizePixel = 0
toggleBtn.Active = true
toggleBtn.Draggable = true

local hubVisible = true
toggleBtn.MouseButton1Click:Connect(function()
    hubVisible = not hubVisible
    frame.Visible = hubVisible
end)
